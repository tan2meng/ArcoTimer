# ArcoTimer 产品需求文档 (PRD)

## 1. 产品概述

**ArcoTimer** 是一款多功能的时间管理工具，旨在帮助用户高效管理时间、通过结构化的计时方式提升专注力和生产力。本产品将基于 **Flutter** 框架开发，支持 Android 和 iOS 双平台（未来可扩展至 Desktop/Web），提供流畅的原生体验。

核心功能模块包括：
1.  **循环定时器 (Loop Timer)**：支持固定间隔的循环提醒。
2.  **分组定时器 (Group Timer)**：专为健身、番茄工作法等场景设计的阶段性计时器。
3.  **普通闹钟 (Alarm)**：基础的闹钟提醒功能。
4.  **节点震动提醒 (Shake Alarm)**：在一段总时长内，设置多个特定的提醒节点（Shake Points）。

---

## 2. 技术架构 (Flutter)

### 2.1 总体架构
采用 **Clean Architecture** (整洁架构) 分层设计，确保代码的可维护性、可测试性和扩展性。

*   **Presentation Layer (表现层)**:
    *   使用 Flutter UI 组件库 (Material 3 / Cupertino)。
    *   **状态管理**: 推荐使用 **Riverpod** 或 **Bloc**。
    *   负责 UI 渲染、用户交互处理、动画效果。
*   **Domain Layer (领域层)**:
    *   包含 Entity (实体)、Repository Interface (仓库接口) 和 Usecase (用例)。
    *   纯 Dart 代码，不依赖具体平台实现。
*   **Data Layer (数据层)**:
    *   **Repository Implementation**: 实现领域层接口。
    *   **Local Data Source**: 使用 **Isar** 或 **Hive** 进行本地数据持久化（存储定时器配置、历史记录）。
    *   **Platform Services**: 通过 Method Channel 调用原生能力（震动、后台保活、通知、音频播放）。

### 2.2 关键技术点
*   **后台保活 (Background Execution)**:
    *   使用 `flutter_background_service` 或类似库，确保定时器在后台或锁屏状态下仍能准确计时。
    *   利用 Android Foreground Service 和 iOS Background Modes (Audio/Processing)。
*   **通知与提醒 (Notifications & Alarms)**:
    *   集成 `flutter_local_notifications` 处理本地推送。
    *   使用 `audioplayers` 或原生接口播放自定义提示音。
    *   使用 `vibration` 库控制不同强度的震动反馈。
*   **国际化 (i18n)**:
    *   使用 `flutter_localizations` 支持多语言切换。

---

## 3. 功能需求详细描述

### 3.1 底部导航 / 侧边栏 (Navigation)
*   **功能**: 在四个核心功能模块间切换。
*   **交互**:
    *   移动端：底部导航栏 (BottomNavigationBar)。
    *   桌面端/平板：侧边栏 (NavigationRail)。
    *   点击图标切换页面，当前选中项高亮。

### 3.2 循环定时器 (Loop Timer)
#### 3.2.1 功能描述
用户可以创建多个循环定时器，每个定时器设定一个时间间隔（如每 30 分钟），启动后会无限循环倒计时并提醒，直到手动停止。

#### 3.2.2 详细特性
*   **列表展示**:
    *   卡片式展示所有创建的循环定时器。
    *   显示内容：名称、间隔时间、累计触发次数、当前开关状态。
    *   **动态效果**: 开启状态下，卡片底部显示倒计时进度条。
*   **创建/编辑**:
    *   设置名称 (Name)。
    *   设置时间间隔 (Interval Value & Unit: 秒/分/时)。
    *   (可选) 设置生效时间段 (Active Hours)：如仅在 9:00 - 18:00 生效。
    *   (可选) 设置特定开始时间 (Start Time)。
*   **操作**:
    *   **快速开关**: 卡片上的 Toggle 按钮直接开启/关闭定时器。
    *   **编辑**: 点击卡片进入编辑详情。
    *   **删除**: 支持删除不再需要的定时器。

#### 3.2.3 交互逻辑
1.  **启动**: 点击 Toggle -> 状态变为 Active -> 进度条开始缩减。
2.  **触发**: 倒计时结束 -> 播放提示音/震动 -> 累计次数+1 -> 自动重置并开始下一轮倒计时。
3.  **停止**: 点击 Toggle -> 状态变为 Inactive -> 进度条消失/重置。

### 3.3 分组定时器 (Group Timer)
#### 3.3.1 功能描述
适用于 HIIT 健身、Tabata 或工作/休息交替场景。由多个“组 (Set)”组成，每组包含“准备 (Prep)”、“进行 (Work)”、“休息 (Post/Rest)”三个阶段。

#### 3.3.2 详细特性
*   **配置**:
    *   设置组名。
    *   设置总组数 (Total Sets)。
    *   设置各阶段时长：
        *   Prep Duration (准备时长)
        *   Work Duration (工作时长)
        *   Post Duration (休息时长)
*   **运行界面 (Immersive Mode)**:
    *   **视觉中心**: 大尺寸环形进度条，显示当前阶段剩余时间。
    *   **颜色编码**:
        *   Prep: 黄色 (Yellow)
        *   Work: 品牌色/蓝色 (Blue)
        *   Post: 绿色 (Green)
    *   **信息展示**: 当前是第几组、当前阶段名称（准备/工作/休息）、下一阶段预告。
*   **控制**:
    *   暂停/继续 (Play/Pause)。
    *   重置 (Reset)。
    *   跳过当前阶段 (Skip)。

#### 3.3.3 交互逻辑
1.  **进入运行**: 点击“开始” -> 全屏/沉浸式页面。
2.  **阶段流转**: Prep 倒计时结束 -> 触发短提示 -> 进入 Work -> Work 结束 -> 触发长提示 -> 进入 Post -> Post 结束 -> 组数+1 -> 回到 Prep (直到达到总组数)。
3.  **完成**: 所有组执行完毕 -> 显示“Completed”状态 -> 播放完成音效。

### 3.4 节点震动提醒 (Shake Alarm)
#### 3.4.1 功能描述
这是一个基于时间轴的提醒工具。用户设定一个总时长（如 10 分钟），并在此期间设定多个特定的时间点（Shake Points，如 2分、5分、9分），到达这些点时触发提醒。

#### 3.4.2 详细特性
*   **列表展示**:
    *   显示当前运行中的任务和已保存的配置。
    *   **进度可视化**: 进度条显示总进度，并在进度条上用小刻度标记出 Shake Points 的位置。
*   **创建/编辑**:
    *   设置总时长 (Total Duration)。
    *   添加/删除 Shake Points (时间点)。
    *   设置名称。
*   **运行状态**:
    *   显示当前倒计时。
    *   显示下一个 Shake Point 是第几个。
    *   支持随时停止。

#### 3.4.3 交互逻辑
1.  **运行**: 用户启动一个配置 -> 创建一个新的运行实例 (Instance)。
2.  **过程**: 计时器运行 -> 进度条增长。
3.  **节点触发**: 当经过 Shake Point 时间点 -> 触发震动/声音 -> UI 上高亮该节点。
4.  **多任务**: 允许同时运行多个 Shake Alarm 实例。

### 3.5 普通闹钟 (Alarm)
#### 3.5.1 功能描述
标准的闹钟功能，支持单次或重复提醒。

#### 3.5.2 详细特性
*   设置时间 (时:分)。
*   设置重复规则 (每天、工作日、自定义周几)。
*   设置标签/名称。
*   开关控制。

---

## 4. UI/UX 规范

*   **设计风格**: 简洁、现代、扁平化。
*   **主题模式**:
    *   支持 **Light Mode** (浅色模式): 白底、深灰字、品牌色高亮。
    *   支持 **Dark Mode** (深色模式): 深灰/黑底、浅灰字、降低饱和度的品牌色。
    *   支持跟随系统自动切换。
*   **响应式布局**:
    *   利用 Flutter 的 `LayoutBuilder` 和 `MediaQuery`。
    *   **Mobile**: 单列布局，底部导航。
    *   **Tablet/Desktop**: 网格布局 (Grid) 展示卡片，侧边栏导航。
*   **动画**:
    *   倒计时使用平滑过渡动画（如 `TweenAnimationBuilder`）。
    *   列表项增删使用 `AnimatedList` 或 `AnimatedOpacity`。

## 5. 数据存储与隐私
*   所有数据仅保存在用户本地设备，不上传至云端。
*   使用本地数据库存储用户配置的定时器方案。
*   不需要用户登录/注册系统。

## 6. 异常处理
*   **权限**: 首次启动或首次使用相关功能时，请求通知权限、精确闹钟权限。若拒绝，需引导用户去设置开启。
*   **冲突**: 若多个定时器同时触发，需按优先级队列依次弹出通知或混合播放提示音。